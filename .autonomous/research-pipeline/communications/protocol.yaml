protocol:
  version: "1.0.0"
  last_updated: "{DATE}"

worker_rules:
  must:
    - "Maintain token usage below 40% of context limit"
    - "Write THOUGHTS.md, RESULTS.md, DECISIONS.md every run"
    - "Write ASSUMPTIONS.md when making significant assumptions"
    - "Update heartbeat.yaml every 30 seconds"
    - "Publish events to events.yaml"
    - "Read validator feedback from chat-log.yaml"
    - "Self-modify memory/ files to improve over time"
    - "Checkpoint at 60% token usage"

  must_not:
    - "Write to validator run directories"
    - "Modify other worker's state"
    - "Exceed 60% token budget (hard stop)"
    - "Skip validation checkpoint"

validator_rules:
  must:
    - "Monitor worker output in real-time"
    - "Write feedback to chat-log.yaml"
    - "Log all observations to memory/"
    - "Suggest improvements based on patterns"
    - "Update heartbeat.yaml every 30 seconds"
    - "Help worker plan next iterations"

  must_not:
    - "Execute work (only validate)"
    - "Write to worker run directories"
    - "Modify queue.yaml"
    - "Make decisions for worker"

communication:
  channels:
    - queue.yaml
    - events.yaml
    - chat-log.yaml
    - heartbeat.yaml

  patterns:
    worker_to_validator: "Write to own run/, validator reads and responds via chat-log.yaml"
    phase_to_phase: "Publish events to events.yaml"
    bidirectional: "Use chat-log.yaml for rich communication"

token_budgets:
  scout_worker: 3000
  scout_validator: 1000
  analyst_worker: 4800
  analyst_validator: 1200
  planner_worker: 3600
  planner_validator: 600

escalation:
  token_exceeded: "Checkpoint and exit, wait for next iteration"
  validation_failed: "Worker addresses feedback, retry"
  system_error: "Log to events.yaml, notify human"
