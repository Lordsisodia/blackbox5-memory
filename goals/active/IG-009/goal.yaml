# Goal: Improve Hooks for Automated Maintenance
# =============================================================================
goal_id: IG-009
name: "Improve Hooks for Automated Architecture, Context, and Timeline Maintenance"
description: "Create comprehensive hook system that automatically maintains project timeline, architecture consistency, context synchronization, and ensures all system state is kept up-to-date without manual intervention"

meta:
  created: "2026-02-04"
  target_completion: "2026-02-18"
  owner: "architect-agent"
  priority: high
  status: in_progress
  category: infrastructure

# =============================================================================
# SUB-GOALS
# =============================================================================

sub_goals:
  - id: SG-009-1
    name: "Audit and Document Existing Hooks"
    description: "Review current hooks and document functionality"
    weight: 10
    status: completed

  - id: SG-009-2
    name: "Build Smart Agent-Aware SessionStart Hook"
    description: "Create session-start-blackbox5.sh that auto-detects agent type and loads appropriate context"
    weight: 15
    status: completed

    acceptance_criteria:
      - "Auto-detects agent from run directory path"
      - "Loads planner/executor/architect specific context"
      - "No environment variables required"
      - "Returns additionalContext for Claude"

  - id: SG-009-3
    name: "Build Smart Subagent Tracking Hooks"
    description: "Create subagent-tracking.sh for agent lifecycle logging"
    weight: 15
    status: completed

    acceptance_criteria:
      - "Auto-detects agent type on start/stop"
      - "Logs to communications/events.yaml"
      - "Updates agent-state.yaml"
      - "No manual agent ID required"

  - id: SG-009-4
    name: "Build Smart Pre-Tool Security Hook"
    description: "Create pre-tool-security.py with agent-aware security rules"
    weight: 15
    status: completed

    acceptance_criteria:
      - "Blocks dangerous rm -rf for all agents"
      - "Allows executor .env access"
      - "Blocks planner/executor force push"
      - "Requires architect for destructive DB ops"
      - "Logs all security checks"

  - id: SG-009-5
    name: "Build Supporting Hooks"
    description: "Timeline, architecture, context hooks"
    weight: 25
    status: completed

  - id: SG-009-6
    name: "Create Hook Framework Documentation"
    description: "Document smart hook patterns"
    weight: 10
    status: pending

  - id: SG-009-7
    name: "Integrate and Test All Hooks"
    description: "Register in settings.json and test"
    weight: 10
    status: pending

# =============================================================================
# PROGRESS
# =============================================================================

progress:
  percentage: 75
  last_updated: "2026-02-04"

  by_sub_goal:
    SG-009-1: 100
    SG-009-2: 100
    SG-009-3: 100
    SG-009-4: 100
    SG-009-5: 100
    SG-009-6: 0
    SG-009-7: 0

  summary:
    total_tasks: 7
    completed_tasks: 5
    in_progress_tasks: 0
    blocked_tasks: 0

# =============================================================================
# LINKS
# =============================================================================

links:
  decisions:
    - DEC-2026-02-04-hook-framework

  learnings:
    - "GitHub: carlrannaberg/claudekit - Quality enforcement hooks"
    - "GitHub: hesreallyhim/awesome-claude-code - Community hooks"
    - "GitHub: affaan-m/everything-claude-code - Memory persistence hooks"

  related_goals:
    - IG-006  # Architecture restructuring (hooks support this)
    - CG-003  # System Integrity (hooks enforce this)
    - CG-004  # Navigation (hooks enhance this)

  plans:
    - hooks-framework

# =============================================================================
# NOTES
# =============================================================================

notes: |
  SMART HOOKS PRINCIPLE: No environment variables needed
  =====================================================
  All hooks self-discover context from:
  - Run directory path (runs/planner/, runs/executor/)
  - Current working directory
  - File patterns (queue.yaml = planner, task-*-spec.md = executor)
  - Parent directory structure

  This makes hooks work automatically regardless of how agents are spawned.

  Hook Inventory (9 total):
  ========================

  SessionStart Hooks:
  - session-start-blackbox5.sh (NEW) - Agent-aware context loading
    * Auto-detects planner/executor/architect
    * Loads agent-specific context
    * Returns additionalContext for Claude

  PreToolUse Hooks:
  - pre-tool-security.py (NEW) - Agent-aware security
    * Blocks rm -rf for all agents
    * Allows executor .env access
    * Blocks planner/executor force push
    * Requires architect for DB ops
  - pre-tool-validation.sh (existing) - Structure validation
  - architecture-consistency.sh (NEW) - Naming conventions

  PostToolUse Hooks:
  - timeline-maintenance.sh (NEW) - Auto-update timeline
  - context-synchronization.sh (NEW) - Sync across files

  Subagent Hooks:
  - subagent-tracking.sh (NEW) - Agent lifecycle logging
    * Logs to communications/events.yaml
    * Updates agent-state.yaml

  Stop Hooks:
  - stop-hierarchy-update.sh (existing) - Parent timeline updates

  Research Integration:
  - claude-code-hooks-mastery patterns adapted
  - UV single-file script pattern (Python hooks)
  - JSON logging standardization
  - Exit code semantics (0=continue, 2=block)
  - Agent-aware adaptations for BB5
