---
id: "PLAN-HINDSIGHT-001"
title: "Hindsight Memory Architecture Integration"
slug: "hindsight-memory-integration"
status: "draft"
stage: "01-draft"

# Metadata
created_at: "2026-02-04T07:00:00Z"
created_by: "claude"
updated_at: "2026-02-04T07:00:00Z"

# Classification
category: "architecture"
domain: "memory"
priority: "critical"

# Relationships
depends_on: []
blocks: []
blocked_by: []
relates_to:
  - "PLAN-MEMORY-REORG-001"
parent_improvement: null

# Tasks
related_tasks:
  - "TASK-MEMORY-001"

# Effort Tracking
estimated_hours: 240  # 6 weeks x 40 hours
actual_hours: 0
progress: 0.0

# Review
review_status: "not-reviewed"
reviewed_by: null
reviewed_at: null
approval_notes: null

# Tags
tags:
  - "memory"
  - "architecture"
  - "hindsight"
  - "agent-memory"
  - "knowledge-graph"
  - "semantic-search"

# Links
proposal_link: null
research_link: "5-project-memory/blackbox5/knowledge/research/agent-memory-systems/"
design_link: null
plan_link: "5-project-memory/blackbox5/plans/active/hindsight-memory-integration/plan.yaml"
action_plan_link: "5-project-memory/blackbox5/action-plans/hindsight-memory-integration/"
active_link: null
completion_link: null

# Git Integration
git_branch: null
git_pr: null

# Custom Metadata
metadata:
  total_phases: 6
  current_phase: 0
  target_benchmark: "70% of Hindsight capabilities"
  integration_complexity: "high"
---

# Hindsight Memory Architecture Integration

## Overview

Integrate Hindsight's 4-network memory architecture (World, Experience, Opinion, Observation) and 3-core-operations (RETAIN, RECALL, REFLECT) into Blackbox5's existing project memory structure. This will upgrade BB5's memory system from basic file-based storage to a sophisticated, queryable, and evolving memory substrate.

**Key Integration Points:**
- Add Hindsight's 4 networks as new file types (FACTS.md, EXPERIENCES.md, OPINIONS.md, OBSERVATIONS.md)
- Implement RETAIN/RECALL/REFLECT operations as automated pipelines
- Leverage existing PostgreSQL (add pgvector) and Neo4j infrastructure
- Maintain backward compatibility with existing THOUGHTS.md/DECISIONS.md structure

## Success Criteria

- [ ] All 4 memory networks (W/B/O/S) functional
- [ ] RETAIN operation automatically extracts memory from tasks/runs
- [ ] RECALL operation enables semantic search across all history
- [ ] REFLECT operation enables belief updating
- [ ] 70% of Hindsight capabilities implemented
- [ ] Existing memory files remain backward compatible
- [ ] Performance: <500ms recall latency
- [ ] Coverage: >90% of tasks processed by RETAIN

## Architecture Overview

### Current BB5 Memory Structure
```
GOALS → PLANS → TASKS → RUNS
  ↓       ↓       ↓       ↓
Journal  Research Timeline  Agent Sessions
```

**Per-Task Files:** THOUGHTS.md, DECISIONS.md, LEARNINGS.md, RESULTS.md
**Per-Run Files:** metadata.yaml, THOUGHTS.md, DECISIONS.md, RESULTS.md
**Infrastructure:** PostgreSQL, Neo4j, Redis, File system

### Hindsight Integration Mapping

| Hindsight Component | BB5 Location | Source |
|--------------------|--------------|--------|
| World Network (W) | `FACTS.md` | Extracted from DECISIONS.md |
| Experience Network (B) | `EXPERIENCES.md` | Extracted from THOUGHTS.md |
| Opinion Network (O) | `OPINIONS.md` | Extracted from decisions + rationale |
| Observation Network (S) | `OBSERVATIONS.md` | Synthesized from LEARNINGS.md |
| RETAIN Operation | `.autonomous/memory/operations/` | Automated extraction pipeline |
| RECALL Operation | `.autonomous/memory/operations/` | Multi-strategy retrieval API |
| REFLECT Operation | `.autonomous/memory/operations/` | Belief updating system |

## Phase Breakdown

### Phase 1: Foundation - Add 4-Network File Structure (Week 1)

**Objective:** Create new memory file templates and project structure

**Key Deliverables:**
- 4 new memory file templates (FACTS.md, EXPERIENCES.md, OPINIONS.md, OBSERVATIONS.md)
- Updated task and run templates
- Project-level memory structure in `.autonomous/memory/`

**Files Created:**
- `.templates/memory/FACTS.md`
- `.templates/memory/EXPERIENCES.md`
- `.templates/memory/OPINIONS.md`
- `.templates/memory/OBSERVATIONS.md`
- `.autonomous/memory/config.yaml`

### Phase 2: Infrastructure - Database Setup (Week 2)

**Objective:** Set up pgvector and extend Neo4j schema

**Key Deliverables:**
- pgvector extension installed in PostgreSQL
- Memory tables created (memory_contents, memory_entities, memory_opinions)
- Neo4j schema extended for memory graph
- Embedding pipeline implemented

**Technical Components:**
- PostgreSQL + pgvector for vector search
- Neo4j for entity relationships
- Embedding service (OpenAI text-embedding-3-small)

### Phase 3: RETAIN Operation - Automated Ingestion (Week 3)

**Objective:** Build automated extraction pipeline

**Key Deliverables:**
- RETAIN operation implementation
- Entity extraction from markdown files
- Fact/opinion/experience/observation extraction
- PostgreSQL + Neo4j storage pipeline
- Automation workflow

**Integration Points:**
- Hook: Run RETAIN when task completed
- Process: Extract → Classify → Store → Index

### Phase 4: RECALL Operation - Multi-Strategy Retrieval (Week 4)

**Objective:** Implement semantic search across all memory

**Key Deliverables:**
- RECALL operation with 4 strategies (semantic, keyword, graph, temporal)
- Reciprocal Rank Fusion merging
- Task loader integration (inject relevant memory into new tasks)
- CLI interface for memory queries

**Search Strategies:**
1. Semantic (vector similarity via pgvector)
2. Keyword (BM25 via PostgreSQL full-text)
3. Graph (entity traversal via Neo4j)
4. Temporal (recency-weighted)

### Phase 5: REFLECT Operation - Preference-Conditioned Reasoning (Week 5)

**Objective:** Enable belief updating and consistent reasoning

**Key Deliverables:**
- REFLECT operation implementation
- Disposition profiles (skepticism, literalism, empathy, bias)
- Belief updating with confidence scores
- Integration with RECALL for context-aware reasoning

**Features:**
- Confidence score tracking
- Evidence accumulation
- Belief revision on contradiction
- Consistent agent personality

### Phase 6: Integration & Testing (Week 6)

**Objective:** Full pipeline integration and validation

**Key Deliverables:**
- Task creation/completion hooks
- RALF integration
- Unit and integration tests
- Performance benchmarks
- Documentation

**Testing:**
- End-to-end pipeline validation
- Cross-task retrieval tests
- Performance benchmarks (<500ms recall)
- Coverage metrics (>90% tasks processed)

## Dependencies

### External Dependencies
- PostgreSQL 14+ with pgvector extension
- Neo4j 5+ (already in use for RAPS)
- OpenAI API (for embeddings)
- Python 3.11+

### Internal Dependencies
- Existing PostgreSQL TaskRegistry
- Existing Neo4j graph (RAPS)
- Existing task/run folder structure
- RALF hook system

### Blocked By
- None (can start immediately)

### Blocks
- Advanced agent self-improvement
- Cross-task pattern detection
- Automated learning extraction

## Resource Requirements

### People
- Claude (primary implementer)
- User (review and guidance)

### Infrastructure
- PostgreSQL with pgvector
- Neo4j (existing)
- OpenAI API credits (embeddings)

### Time
- 6 weeks, 1 engineer
- 40 hours/week estimated

## Timeline

| Phase | Duration | Focus | Milestone |
|-------|----------|-------|-----------|
| 1 | Week 1 | File structure | Templates created |
| 2 | Week 2 | Infrastructure | Databases ready |
| 3 | Week 3 | RETAIN | Extraction working |
| 4 | Week 4 | RECALL | Search working |
| 5 | Week 5 | REFLECT | Beliefs updating |
| 6 | Week 6 | Integration | Full pipeline |

### Milestones

**M1: Structure Complete (End Week 1)**
- All 4 memory file templates created
- Project structure established

**M2: Infrastructure Ready (End Week 2)**
- pgvector installed and working
- Neo4j schema extended
- Embedding pipeline functional

**M3: RETAIN Working (End Week 3)**
- Automatic extraction from tasks
- Entities, facts, opinions stored

**M4: RECALL Working (End Week 4)**
- Multi-strategy search functional
- Task injection working

**M5: REFLECT Working (End Week 5)**
- Belief updating functional
- Confidence tracking working

**M6: Complete (End Week 6)**
- Full pipeline integrated
- Tests passing
- Documentation complete

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| pgvector performance issues | Medium | High | Benchmark early, consider Pinecone fallback |
| Embedding costs | Medium | Medium | Use text-embedding-3-small, cache aggressively |
| Complexity overrun | High | High | Phase-gate reviews, MVP first |
| Neo4j schema conflicts | Low | High | Test against existing RAPS graph |
| Backward compatibility | Low | Medium | Keep existing files untouched |

## Rollback Plan

If integration fails:

1. **Disable hooks** - Stop automatic memory processing
2. **Revert templates** - Remove new memory files from templates
3. **Keep databases** - Don't delete pgvector/Neo4j data (for retry)
4. **Document state** - Record what was working
5. **Fallback** - Continue with existing memory system

## Success Metrics

### Quantitative

| Metric | Target | Measurement |
|--------|--------|-------------|
| RETAIN coverage | >90% | % of tasks processed |
| RECALL latency | <500ms | Average query time |
| RECALL relevance | >80% | Human-rated relevance |
| Memory growth | Linear | Storage per task |
| Test coverage | >70% | Code coverage |

### Qualitative

- Agents can find relevant past work
- Decisions reference previous reasoning
- Beliefs evolve with evidence
- Cross-task patterns emerge
- "Continuity of self" maintained

## Research Foundation

This plan is based on extensive research documented in:

- `knowledge/research/agent-memory-systems/hindsight-deep-dive.md`
- `knowledge/research/agent-memory-systems/two-buffers-theory.md`
- `knowledge/research/agent-memory-systems/memory-system-comparison.md`
- `knowledge/research/agent-memory-systems/blackbox5-memory-analysis.md`
- `knowledge/research/agent-memory-systems/hindsight-first-principles-analysis.md`

## Next Steps

1. **Review this plan** - Get feedback, adjust as needed
2. **Create detailed action plan** - Break into actionable tasks in `action-plans/`
3. **Set up tracking** - Create tasks for each phase
4. **Begin Phase 1** - Start with file templates
5. **Weekly reviews** - Check progress, adjust timeline

## Definition of Done

This plan is complete when:
- [ ] All 6 phases implemented and tested
- [ ] 4 memory networks functional (W/B/O/S)
- [ ] 3 operations working (RETAIN/RECALL/REFLECT)
- [ ] >90% task coverage by RETAIN
- [ ] <500ms RECALL latency
- [ ] Backward compatibility maintained
- [ ] Documentation complete
- [ ] No critical bugs remain

## Readiness Checklist

Before moving to active:
- [x] Research complete (see knowledge/research/agent-memory-systems/)
- [x] Architecture analyzed
- [x] Dependencies identified
- [x] Timeline estimated
- [x] Risks assessed
- [ ] Plan reviewed and approved
- [ ] Resources allocated

## References

- **Hindsight Paper:** arXiv:2512.12818
- **Hindsight GitHub:** https://github.com/vectorize-io/hindsight
- **Two Buffers Theory:** Moltbook m/emergence (Solaria)
- **Action Plan:** `action-plans/hindsight-memory-integration/`
